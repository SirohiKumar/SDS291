---
title: "SDS 291 - STAT2 R Companion Chapter 1: Simple Linear Regression"
output:
  html_document:
    df_print: paged
---

## Section 1.1: The Simple Linear Regression Model (01-30-24)

#### load libraries + data
```{r message=FALSE}

library(ggplot2)
library(Stat2Data)
library(broom)
library(dplyr)
library(equatiomatic) ##remotes::install_github("datalorax/equatiomatic")

data("AccordPrice")
head(AccordPrice)

```

#### preliminary visualization
```{r}

plot = ggplot(AccordPrice, mapping = aes(x = Mileage, y = Price)) + 
  geom_point(color="#92278f") + ## using the colors from the STAT2 textbook
  theme_bw() 

plot

```

#### fitting a simple linear regression model

given the ~ implies a linear model formula: y ~ x
```{r}

price_model = lm(Price ~ Mileage, AccordPrice) 
# summary(price_model)

```

extract just the coefficient values: 
```{r}

coef(price_model)

```

this anova's p-value indicates the variance between car price is significant
```{r}

anova(price_model)

```

#### adding the regression line to the scatter plot

geom smooth is a generic smoothing function. the method argument tells it to display the linear model on the plot. 
```{r warning=FALSE}

plot = plot + geom_smooth(method = lm, se = FALSE, forumla = y ~ x)

plot

```

#### examine the residuals

returns a vector with an element for each row of the dataset
```{r}

residuals(price_model)

```

however, this vector is missing the predicted output values generated by `price_model`. the predicted values are in the .fitted columns and the residuals in the .resid column. 
```{r}

augment(price_model)

```

#### centering the explanatory variable

use the `dplyr` package's `mutate` function to generate a new column with centered Mileage values. 
```{r}

AccordPrice = AccordPrice %>%
  mutate(cMileage = Mileage - 50)

head(AccordPrice)

```

we can now recreate the model with the centered values using `lm()` again. 
```{r}

centered_model = lm(Price ~ cMileage, AccordPrice)
coef(centered_model)

```

display the model looking fancy
```{r}

extract_eq(centered_model, use_coefs = TRUE)

```

## Section 1.4: Transformations/Reexpressions (02-28-24)

#### load libraries
```{r message=FALSE}

library(Stat2Data)
library(equatiomatic)
library(ggplot2)
library(dplyr)
library(performance)
library(see)

```

#### load data
```{r}

data("CountyHealth")
head(CountyHealth)

```

#### generate model and equation
```{r}

doctor_model = lm(MDs ~ Hospitals, data = CountyHealth)
extract_eq(doctor_model, use_coefs = TRUE)

```

#### visualize data
```{r}

ggplot(data = CountyHealth, aes(x = Hospitals,
                                y = MDs)) +
  geom_point() +
  geom_smooth(method = lm, formula = y ~ x, se = FALSE) +
  scale_y_continuous(breaks = seq(0, 8000, by = 2000)) +
  theme_bw() 

## set the bounds for the y-axis and where the breaks are

```

#### determine the quality of this model
```{r}

check_model(doctor_model, check = c("homogeneity", "qq"))

```

#### square root transformation
```{r}

sqrt_model = lm(sqrt(MDs) ~ Hospitals, data = CountyHealth)
extract_eq(sqrt_model, use_coefs = T)

```

#### check the sqrt transformed model
```{r}

check_model(sqrt_model, check = c("homogeneity", "qq"))

```

#### visualizing the transformation

we're going to fit the model on the transformed scale, but visualize the predictions on the original scale
```{r warning=FALSE}

ggplot(CountyHealth, aes(x = Hospitals, y = MDs)) +
  geom_point() +
  geom_smooth(method = lm, se = F, formula = y ~ x) + 
  scale_y_sqrt(breaks = seq(0, 8000, by = 2000), expand = c(0, 10)) + 
  coord_trans(y = scales::trans_new("square", function(x) x^2, "sqrt"))

## set the bounds and breaks for the y axis
## transform the way the y-axis is visualized to match the original

```

### using log transformations

#### load data
```{r}

data("SpeciesArea")
head(SpeciesArea)

```

#### generate the log transformed model
```{r}

log_model = lm(log(Species) ~ log(Area), data = SpeciesArea)
extract_eq(log_model, use_coefs = T)

```

#### generate the visualization of that model's data
```{r}

ggplot(SpeciesArea, aes(x = Area, y = Species)) +
  geom_point() +
  geom_smooth(method = lm, se = F, formula = y ~ x) +
  scale_x_continuous(trans = "log") + 
  scale_y_continuous(trans = "log") + 
  theme_bw()

```

